{% extends "base.html" %}

{% block title %}Dashboard - NIDS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Dashboard</h1>
    <p>Welcome back, {{ current_user.username }}!</p>
</div>

{# Model Insight section removed as requested #}

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-value">{{ total_predictions }}</div>
        <div class="stat-label">Total Predictions</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-value">{{ threats_detected }}</div>
        <div class="stat-label">Threats Detected</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üìà</div>
        <div class="stat-value">{{ avg_confidence | round(2) }}%</div>
        <div class="stat-label">Avg. Confidence</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üõ°Ô∏è</div>
        <div class="stat-value">{{ best_model }}</div>
        <div class="stat-label">Model Used</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üéØ</div>
        <div class="stat-value">{{ accuracy }}</div>
        <div class="stat-label">Model Accuracy</div>
    </div>
</div>

<div class="dashboard-charts">
    <h2>Insights</h2>
    <div class="charts-grid">
        <div class="chart-container">
            <canvas id="chart1"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="chart2"></canvas>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart 1: Threat vs Normal Distribution (Bar Chart)
    var ctx1 = document.getElementById('chart1').getContext('2d');
    var threatVsNormal = {{ threat_vs_normal|tojson }};
    var chart1 = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: threatVsNormal.map(function(item) { return item.result; }),
            datasets: [{
                label: 'Count',
                data: threatVsNormal.map(function(item) { return item.count; }),
                backgroundColor: ['#4e79a7', '#f28e2b']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Threat vs Normal Predictions'
                }
            }
        }
    });

    // Chart 2: Threats Over Time (Line Chart)
    var ctx2 = document.getElementById('chart2').getContext('2d');
    var threatsOverTime = {{ threats_over_time|tojson }};
    var chart2 = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: threatsOverTime.map(function(item) { return item.day; }),
            datasets: [{
                label: 'Threats Detected',
                data: threatsOverTime.map(function(item) { return item.count; }),
                fill: false,
                borderColor: '#e15759',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Threats Over Time'
                }
            }
        }
    });
</script>
{% endblock %}
