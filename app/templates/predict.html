{% extends "base.html" %}

{% block title %}Predict - NIDS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Network Traffic Prediction</h1>
    <p>Enter network features to detect potential threats</p>
</div>

{% set feature_info = {
    'duration': {'label': 'Duration (seconds)', 'desc': 'Length of the connection in seconds.', 'type': 'slider', 'min': 0, 'max': 1000, 'step': 1},
    'src_bytes': {'label': 'Source Bytes', 'desc': 'Bytes sent from source to destination.', 'type': 'slider', 'min': 0, 'max': 100000, 'step': 1},
    'dst_bytes': {'label': 'Destination Bytes', 'desc': 'Bytes sent from destination to source.', 'type': 'slider', 'min': 0, 'max': 100000, 'step': 1},
    'num_failed_logins': {'label': 'Failed Logins', 'desc': 'Number of failed login attempts.', 'type': 'slider', 'min': 0, 'max': 10, 'step': 1},
    'logged_in': {'label': 'Logged In', 'desc': 'Was the login successful? (1 = Yes, 0 = No)', 'type': 'checkbox'},
    'num_compromised': {'label': 'Compromised Conditions', 'desc': 'Number of compromised conditions.', 'type': 'slider', 'min': 0, 'max': 10, 'step': 1},
    'root_shell': {'label': 'Root Shell', 'desc': 'Root shell obtained? (1 = Yes, 0 = No)', 'type': 'checkbox'},
    'su_attempted': {'label': 'su Attempted', 'desc': 'su root command attempted? (1 = Yes, 0 = No)', 'type': 'checkbox'},
    'num_shells': {'label': 'Number of Shells', 'desc': 'Number of shell prompts.', 'type': 'slider', 'min': 0, 'max': 5, 'step': 1},
    'count': {'label': 'Count', 'desc': 'Number of connections to the same host in the past 2 seconds.', 'type': 'slider', 'min': 0, 'max': 100, 'step': 1},
    'srv_count': {'label': 'Service Count', 'desc': 'Number of connections to the same service in the past 2 seconds.', 'type': 'slider', 'min': 0, 'max': 100, 'step': 1},
    'serror_rate': {'label': 'SYN Error Rate', 'desc': 'Percentage of connections with SYN errors.', 'type': 'slider', 'min': 0, 'max': 1, 'step': 0.01},
    'rerror_rate': {'label': 'REJ Error Rate', 'desc': 'Percentage of connections with REJ errors.', 'type': 'slider', 'min': 0, 'max': 1, 'step': 0.01},
    'protocol_type': {'label': 'Protocol Type', 'desc': 'Type of protocol used.', 'type': 'dropdown'},
    'service': {'label': 'Service', 'desc': 'Network service on the destination.', 'type': 'dropdown'}
} %}

<form method="POST" class="prediction-form">
    {% set required_features = [
        'duration', 'src_bytes', 'dst_bytes', 'num_failed_logins', 'logged_in',
        'num_compromised', 'root_shell', 'su_attempted', 'num_shells', 'count',
        'srv_count', 'serror_rate', 'rerror_rate', 'protocol_type', 'service'
    ] %}
    {% for feature in required_features %}
    <div class="form-group">
        <label for="{{ feature }}">{{ feature_info[feature].label }}</label>
        {% if feature_info[feature].type == 'slider' %}
        <input type="range" name="{{ feature }}" id="{{ feature }}" min="{{ feature_info[feature].min }}" max="{{ feature_info[feature].max }}" step="{{ feature_info[feature].step }}" value="{{ input_data[feature] if input_data else feature_info[feature].min }}" title="{{ feature_info[feature].desc }}" data-feature="{{ feature }}">
        <span class="slider-value" id="{{ feature }}-value" data-feature="{{ feature }}">{{ input_data[feature] if input_data else feature_info[feature].min }}</span>
        {% elif feature_info[feature].type == 'checkbox' %}
        <input type="checkbox" name="{{ feature }}" id="{{ feature }}" value="1" {% if input_data and input_data[feature]|int == 1 %}checked{% endif %} title="{{ feature_info[feature].desc }}">
        <span style="font-size:0.95em; color:#64748b;">{{ feature_info[feature].desc }}</span>
        {% elif feature == 'protocol_type' %}
        <select name="protocol_type" id="protocol_type" required title="{{ feature_info[feature].desc }}">
            <option value="">Select Protocol</option>
            <option value="tcp">TCP</option>
            <option value="udp">UDP</option>
            <option value="icmp">ICMP</option>
        </select>
        <span style="font-size:0.95em; color:#64748b;">{{ feature_info[feature].desc }}</span>
        {% elif feature == 'service' %}
        <select name="service" id="service" required title="{{ feature_info[feature].desc }}">
            <option value="">Select Service</option>
            <option value="http">HTTP</option>
            <option value="ftp">FTP</option>
            <option value="smtp">SMTP</option>
            <option value="domain_u">DNS</option>
        </select>
        <span style="font-size:0.95em; color:#64748b;">{{ feature_info[feature].desc }}</span>
        {% else %}
        <input type="text" name="{{ feature }}" id="{{ feature }}" value="{{ input_data[feature] if input_data else '' }}" required title="{{ feature_info[feature].desc }}">
        <span style="font-size:0.95em; color:#64748b;">{{ feature_info[feature].desc }}</span>
        {% endif %}
    </div>
    {% endfor %}
    <button type="submit" class="btn-primary">Predict</button>
</form>

{% if prediction %}
<div class="results-card">
    <h2>Prediction Results</h2>
    <div class="result-display">
        <div class="result-icon">
            {% if prediction == 'normal' %}üõ°Ô∏è{% else %}‚ö†Ô∏è{% endif %}
        </div>
        <div class="result-text">
            <h3>{{ prediction|upper }}</h3>
            <p>Confidence: {{ confidence }}%</p>
            <p>Model Used: {{ model_used }}</p>
        </div>
    </div>
</div>
{% else %}
<div class="results-card">
    <h2>Prediction Results</h2>
    <div class="result-text">
        <p>No prediction yet. Please enter input and submit to get a result.</p>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update all slider value displays
    document.querySelectorAll('input[type="range"][data-feature]').forEach(function(slider) {
        var feature = slider.getAttribute('data-feature');
        var output = document.querySelector('.slider-value[data-feature="' + feature + '"]');
        if (output) {
            slider.addEventListener('input', function() {
                output.textContent = this.value;
            });
        }
    });
});
</script>

<style>
.prediction-form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: space-between;
    margin-bottom: 2em;
}
.prediction-form .form-group {
    flex: 1 1 calc(33% - 1rem);
    min-width: 180px;
    display: flex;
    flex-direction: column;
}
.prediction-form label {
    font-weight: 600;
    margin-bottom: 0.3rem;
}
.prediction-form input,
.prediction-form select {
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 0.9rem;
    background: #f8fafc;
    color: #1e293b;
}
.prediction-form input[type="range"] {
    width: 100%;
    margin-bottom: 0.2em;
}
.slider-value {
    font-size: 0.95em;
    color: #0ea5e9;
    margin-bottom: 0.2em;
}
.btn-primary {
    margin-top: 1rem;
    padding: 0.7rem 1.5rem;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    transition: background 0.2s;
}
.btn-primary:hover {
    background-color: #0056b3;
}
.results-card {
    background: #151B2B;
    border-radius: 12px;
    padding: 1.5rem 2rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    margin-top: 2em;
}
.result-display {
    display: flex;
    align-items: center;
    gap: 2em;
}
.result-icon {
    font-size: 2.5em;
}
.result-text h3 {
    margin: 0 0 0.5em 0;
}
@media (max-width: 900px) {
    .prediction-form .form-group {
        flex: 1 1 100%;
        min-width: 100px;
    }
    .result-display {
        flex-direction: column;
        gap: 1em;
    }
}
</style>
{% endblock %}
